// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Athlete {
  id         String @id @default(cuid())
  firebaseId String @unique

  // Universal Profile (MVP1 Required)
  firstName    String?
  lastName     String?
  email        String    @unique
  phoneNumber  String? // Optional phone number
  gofastHandle String?   @unique
  birthday     DateTime?
  gender       String?
  city         String?
  state        String?
  primarySport String?
  photoURL     String?
  bio          String?
  instagram    String?

  // RunCrew Integration (MVP1) - Junction table handles multiple crews per athlete

  // Training Profile (Future)
  currentPace       String?
  weeklyMileage     Int?
  trainingGoal      String?
  targetRace        String?
  trainingStartDate DateTime?

  // Match Profile (Future)
  preferredDistance String?
  timePreference    String?
  paceRange         String?
  runningGoals      String?

  // Garmin OAuth 2.0 PKCE Integration
  garmin_user_id       String?   @unique // Garmin's unique user ID
  garmin_access_token  String? // OAuth access token
  garmin_refresh_token String? // OAuth refresh token
  garmin_expires_in    Int? // Token expiration time in seconds
  garmin_scope         String? // OAuth scope permissions
  garmin_connected_at  DateTime? // When Garmin was connected
  garmin_last_sync_at  DateTime? // Last data sync timestamp

  // Garmin Permissions & Status
  garmin_permissions     Json? // Store Garmin permission details
  garmin_is_connected    Boolean   @default(false) // Simple connected status
  garmin_disconnected_at DateTime? // When user disconnected

  // STRAVA
  strava_id            Int?    @unique
  strava_access_token  String?
  strava_refresh_token String?
  strava_expires_at    Int?

  // Garmin Rich User Data (from API)
  garmin_user_profile     Json? // Store rich user profile data from Garmin API
  garmin_user_sleep       Json? // Store sleep preferences
  garmin_user_preferences Json? // Store user preferences and settings

  // System fields
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  status    String? // Optional status field - no default

  // Relations
  activities AthleteActivity[]

  // RunCrew Relations
  adminRunCrews       RunCrew[]            @relation("RunCrewAdmin") // Crews this athlete created/admin
  runCrewMemberships  RunCrewMembership[]  @relation("AthleteRunCrewMemberships") // Crew memberships (junction table - athlete can be in multiple crews)
  runCrewMessages       RunCrewMessage[] @relation // Messages authored by this athlete
  runCrewAnnouncements  RunCrewAnnouncement[] @relation("RunCrewAnnouncementAuthor") // Announcements authored by this athlete
  runCrewLeaderboards RunCrewLeaderboard[] // Leaderboard entries for this athlete
  runCrewRuns         RunCrewRun[] @relation("RunCrewRunCreator") // Runs created by this athlete
  runCrewRunRSVPs     RunCrewRunRSVP[] @relation("RunCrewRunRSVP") // RSVPs to runs by this athlete
  runCrewEvents       RunCrewEvent[] @relation("RunCrewEventOrganizer") // Events organized by this athlete
  runCrewEventRSVPs   RunCrewEventRSVP[] @relation("RunCrewEventRSVP") // RSVPs to events by this athlete
  runCrewManagers     RunCrewManager[] @relation("RunCrewManager") // RunCrews this athlete manages (future)

  // Training Relations
  createdRaces  Race[]                @relation("RaceCreator") // Races this athlete created (optional)
  trainingPlans TrainingPlan[]
  plannedDays   TrainingDayPlanned[]
  executedDays  TrainingDayExecuted[]

  // Founder Relations
  founder Founder?

  @@map("athletes")
}

model AthleteActivity {
  id        String @id @default(cuid())
  athleteId String

  // Source Information
  sourceActivityId String @unique // Garmin's unique activity ID (join key)
  source           String @default("garmin")

  // Core Activity Data (Summary from /garmin/activity webhook)
  activityType String? // running, cycling, swimming, etc.
  activityName String? // "Morning Run", "Evening Bike Ride"
  startTime    DateTime? // when activity started
  duration     Int? // duration in seconds
  distance     Float? // distance in meters
  averageSpeed Float? // average speed in m/s
  calories     Int? // calories burned

  // Performance Metrics (Summary data)
  averageHeartRate Int? // average heart rate
  maxHeartRate     Int? // maximum heart rate
  elevationGain    Float? // elevation gain in meters
  steps            Int? // step count (if applicable)

  // Location Data (Summary)
  startLatitude   Float? // GPS start latitude
  startLongitude  Float? // GPS start longitude
  endLatitude     Float? // GPS end latitude
  endLongitude    Float? // GPS end longitude
  summaryPolyline String? // encoded route polyline

  // Device Information
  deviceName   String? // "Forerunner 255", "Edge 1040"
  garminUserId String? // Garmin user GUID from webhook

  // Hybrid Data Storage
  summaryData Json? // Phase 1: Summary fields from /garmin/activity
  detailData  Json? // Phase 2: Details from /garmin/details (laps, splits, HR zones, etc.)
  hydratedAt  DateTime? // When details were hydrated

  // Timestamps
  syncedAt      DateTime @default(now())
  lastUpdatedAt DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  athlete Athlete @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  @@map("athlete_activities")
}

// RunCrew Models
model RunCrew {
  id             String  @id @default(cuid())
  name           String
  description    String? // Optional crew description/motto
  joinCode       String  @unique // Unique invite code for joining
  logo           String? // Optional logo/image URL
  icon           String? // Optional emoji/icon (alternative to logo)
  runcrewAdminId String? // Athlete ID of the creator/admin (nullable temporarily for migration)

  // Status & Archive
  isArchived Boolean   @default(false) // Soft delete - archive crew instead of deleting
  archivedAt DateTime? // When crew was archived

  // System fields
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  admin         Athlete?              @relation("RunCrewAdmin", fields: [runcrewAdminId], references: [id])
  memberships   RunCrewMembership[]   // Junction table for members
  messages      RunCrewMessage[]      // Simple chat messages (real-time via socket)
  announcements RunCrewAnnouncement[] // Admin announcements
  leaderboardEntries RunCrewLeaderboard[] // Leaderboard stats (calculated cache)
  runs          RunCrewRun[]          // Runs (MVP1: admin only)
  events        RunCrewEvent[]        // General events (future - happy hour, social, etc.)
  managers      RunCrewManager[]      // Delegated managers (future)

  @@map("run_crews")
}

model RunCrewMembership {
  id        String @id @default(cuid())
  runCrewId String
  athleteId String // ATHLETE-FIRST: Foreign key to Athlete

  // Timestamps
  joinedAt  DateTime @default(now())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations - ATHLETE-FIRST: Explicitly tied to athleteId
  runCrew RunCrew @relation(fields: [runCrewId], references: [id], onDelete: Cascade)
  athlete Athlete @relation("AthleteRunCrewMemberships", fields: [athleteId], references: [id], onDelete: Cascade)

  @@unique([runCrewId, athleteId]) // Prevent duplicate memberships
  @@map("run_crew_memberships")
}

// RunCrew Messages - Simple chat box (real-time via socket)
model RunCrewMessage {
  id        String @id @default(cuid())
  runCrewId String
  athleteId String // Message author

  content   String // Message text (just content, no images/likes)

  createdAt DateTime @default(now())

  // Relations
  runCrew RunCrew @relation(fields: [runCrewId], references: [id], onDelete: Cascade)
  athlete Athlete @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  @@map("run_crew_messages")
}

// RunCrew Announcements - Admin announcements
model RunCrewAnnouncement {
  id        String   @id @default(cuid())
  runCrewId String
  authorId  String   // Admin who created it

  title     String
  content   String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  runCrew RunCrew @relation(fields: [runCrewId], references: [id], onDelete: Cascade)
  author  Athlete @relation("RunCrewAnnouncementAuthor", fields: [authorId], references: [id], onDelete: Cascade)

  @@map("run_crew_announcements")
}

// RunCrew Leaderboard - Aggregated stats for competition
model RunCrewLeaderboard {
  id        String @id @default(cuid())
  runCrewId String
  athleteId String

  // Time period
  period      String // 'week', 'month', 'allTime'
  periodStart DateTime // Start of period
  periodEnd   DateTime // End of period

  // Stats
  totalMiles     Float   @default(0)
  totalRuns      Int     @default(0)
  bestPace       String? // Best pace achieved (e.g., "6:25/mi")
  totalCalories  Int     @default(0)
  totalElevation Float   @default(0) // In meters

  // Timestamps
  calculatedAt DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  runCrew RunCrew @relation(fields: [runCrewId], references: [id], onDelete: Cascade)
  athlete Athlete @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  @@unique([runCrewId, athleteId, period, periodStart]) // Prevent duplicate entries for same period
  @@map("run_crew_leaderboards")
}

// RunCrew Runs - MVP1 (Specific to runs, not general events)
model RunCrewRun {
  id           String   @id @default(cuid())
  runCrewId    String
  createdById  String   // Admin or manager who created the run (MVP1: admin only)
  
  title        String
  date         DateTime
  startTime    String   // "6:00 AM"
  location     String
  address      String?
  
  // Run-specific fields
  totalMiles   Float?   // Total miles for the run
  pace         String?  // Target pace (e.g., "8:00-9:00 min/mile")
  stravaMapUrl String?  // Strava map URL for route visualization
  
  description  String?
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // Relations
  runCrew      RunCrew  @relation(fields: [runCrewId], references: [id], onDelete: Cascade)
  createdBy    Athlete  @relation("RunCrewRunCreator", fields: [createdById], references: [id], onDelete: Cascade)
  rsvps        RunCrewRunRSVP[]
  
  @@map("run_crew_runs")
}

// RunCrew Run RSVP - MVP1
model RunCrewRunRSVP {
  id        String   @id @default(cuid())
  runId     String
  athleteId String   // RSVP tied to athleteId
  
  status    String   // "going", "maybe", "not-going"
  
  createdAt DateTime @default(now())
  
  // Relations
  run       RunCrewRun @relation(fields: [runId], references: [id], onDelete: Cascade)
  athlete   Athlete    @relation("RunCrewRunRSVP", fields: [athleteId], references: [id], onDelete: Cascade)
  
  @@unique([runId, athleteId]) // One RSVP per athlete per run
  @@map("run_crew_run_rsvps")
}

// RunCrew Events - Future (General events like happy hour, social, etc.)
// Note: Separate from runs - events are for non-run activities
model RunCrewEvent {
  id           String   @id @default(cuid())
  runCrewId    String
  organizerId  String   // Athlete ID who created the event
  
  title        String
  date         DateTime
  time         String   // "6:00 PM"
  location     String
  address      String?
  description  String?
  eventType    String?  // "happy-hour", "social", "meetup", etc.
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // Relations
  runCrew      RunCrew  @relation(fields: [runCrewId], references: [id], onDelete: Cascade)
  organizer    Athlete  @relation("RunCrewEventOrganizer", fields: [organizerId], references: [id], onDelete: Cascade)
  rsvps        RunCrewEventRSVP[]
  
  @@map("run_crew_events")
}

// RunCrew Event RSVP - Future
model RunCrewEventRSVP {
  id        String   @id @default(cuid())
  eventId   String
  athleteId String   // RSVP tied to athleteId
  
  status    String   // "going", "maybe", "not-going"
  
  createdAt DateTime @default(now())
  
  // Relations
  event      RunCrewEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)
  athlete    Athlete      @relation("RunCrewEventRSVP", fields: [athleteId], references: [id], onDelete: Cascade)
  
  @@unique([eventId, athleteId]) // One RSVP per athlete per event
  @@map("run_crew_event_rsvps")
}

// RunCrew Managers - Future (Delegated managers)
model RunCrewManager {
  id        String @id @default(cuid())
  runCrewId String
  athleteId String
  role      String // "admin" or "manager"
  
  createdAt DateTime @default(now())
  
  // Relations
  runCrew RunCrew @relation(fields: [runCrewId], references: [id], onDelete: Cascade)
  athlete Athlete @relation("RunCrewManager", fields: [athleteId], references: [id], onDelete: Cascade)
  
  @@unique([runCrewId, athleteId])
  @@map("run_crew_managers")
}

// =====================================================
// RACE MODEL - Race Event Details
// =====================================================

model Race {
  id String @id @default(cuid())

  // Race Event Details (PUBLIC - like a hotel in travel)
  raceName      String
  raceType      String // 5k, 10k, 10m, half, marathon, other
  raceDate      DateTime
  location      String?
  distanceMiles Float

  // Optional metadata
  registrationUrl String? // Link to register
  description     String?
  courseProfile   Json? // { elevationGain, difficulty, surface, weather }

  // Optional: Creator/Admin relationship (for admin-created races)
  createdByAthleteId String? // Optional - some races created by admins

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations (ALL OPTIONAL - race is independent)
  createdByAthlete Athlete?       @relation("RaceCreator", fields: [createdByAthleteId], references: [id], onDelete: SetNull)
  trainingPlans    TrainingPlan[]

  @@map("races")
}

// =====================================================
// TRAINING MODELS - MyTraining Container System
// =====================================================

model TrainingPlan {
  id        String @id @default(cuid())
  athleteId String
  raceId    String

  // GOALS
  goalTime              String // "1:45:00"
  goalPace              String? // "8:00" per mile
  baseline5k            String // "24:30"
  baselineWeeklyMileage Int?

  // PLAN STRUCTURE (JSON arrays) - THE BLUEPRINT
  startDate         DateTime
  totalWeeks        Int
  phaseOverview     Json? // { base: { weeks, startWeek, endWeek }, build: {...}, peak: {...}, taper: {...} }
  weeklyMileagePlan Json? // [{ weekIndex, targetMileage, phase }]
  weeks             Json? // [{ weekIndex, startDate, endDate, phase, targetMileage, workoutTypes, keyWorkouts }]

  // MONEY METRIC
  adaptive5kTime String? // Only persistent predictive metric!

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  athlete     Athlete                 @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  race        Race                    @relation(fields: [raceId], references: [id], onDelete: Cascade)
  plannedDays TrainingDayPlanned[]
  executions  TrainingPlanExecution[]

  @@map("training_plans")
}

model TrainingDayPlanned {
  id             String @id @default(cuid())
  trainingPlanId String
  athleteId      String

  // Day Identification
  date      DateTime
  weekIndex Int // 0-based
  dayIndex  Int // 0-6 (Mon-Sun)
  dayName   String? // "Monday", "Tuesday", etc.

  // Training Context
  phase String // base, build, peak, taper

  // PLANNED WORKOUT (all the details)
  plannedData Json // { type, mileage, duration, paceRange, targetPace, hrZone, hrRange, segments, label, description, coachNotes }

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  trainingPlan TrainingPlan @relation(fields: [trainingPlanId], references: [id], onDelete: Cascade)
  athlete      Athlete      @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  @@unique([trainingPlanId, weekIndex, dayIndex]) // One planned day per position in plan
  @@map("training_days_planned")
}

model TrainingPlanExecution {
  id             String @id @default(cuid())
  trainingPlanId String

  // Execution metadata
  startedAt DateTime
  status    String   @default("active") // active, completed, cancelled

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  trainingPlan TrainingPlan          @relation(fields: [trainingPlanId], references: [id], onDelete: Cascade)
  executedDays TrainingDayExecuted[]

  @@map("training_plan_executions")
}

model TrainingDayExecuted {
  id          String @id @default(cuid())
  executionId String
  athleteId   String

  // THE LINK - shell container for AthleteActivity
  activityId String? @unique

  // Optional metadata for context
  weekIndex Int
  dayIndex  Int
  date      DateTime

  // Snapshot/computed fields (can be derived from activityId)
  plannedData Json? // Snapshot when executed
  analysis    Json? // { workoutCompleted, hitTargetMileage, hitTargetPace, stayedInHRZone, mileageVariance, paceVariance, qualityScore, performanceNotes }
  feedback    Json? // { mood, effort, injuryFlag, notes, submittedAt }

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  execution TrainingPlanExecution @relation(fields: [executionId], references: [id], onDelete: Cascade)
  athlete   Athlete               @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  @@unique([executionId, date]) // One execution per day per plan execution
  @@map("training_days_executed")
}

// =====================================================
// FOUNDER MODELS - Founder Stack System
// =====================================================

model Founder {
  id        String @id @default(cuid())
  athleteId String @unique // Links to Athlete - founder IS an athlete

  // System
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  athlete         Athlete          @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  tasks           FounderTask[]
  crmContacts     CrmContact[]
  roadmapItems    RoadmapItem[]
  companyFounders CompanyFounder[] // Junction table for companies this founder is part of
  unifiedTasks    Task[]           // Unified tasks (polymorphic link via Task model)

  @@map("founders")
}

model FounderTask {
  id        String @id @default(cuid())
  founderId String

  // Task Details
  title       String
  description String?
  status      String    @default("pending") // pending, in_progress, completed, cancelled
  priority    String    @default("medium") // low, medium, high, urgent
  dueDate     DateTime?

  // Completion
  completedAt DateTime?

  // System
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  founder Founder @relation(fields: [founderId], references: [id], onDelete: Cascade)

  @@map("founder_tasks")
}

model CrmContact {
  id        String @id @default(cuid())
  founderId String

  // Contact Info
  name    String
  role    String? // "Founder @ AcmeAI", "CTO @ BetaCo", "Angel", etc.
  email   String?
  company String?

  // Pipeline Management
  pipeline String // Founders, Collaborators, Funders, Advisors
  status   String @default("New") // New, Warm, Active, Exploring, Cold

  // Next Steps
  nextStep String? // "Coffee chat Thu", "Send 1-pager", "Bi-weekly sync"

  // Notes
  notes String?

  // System
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  founder Founder @relation(fields: [founderId], references: [id], onDelete: Cascade)

  @@map("crm_contacts")
}

model RoadmapItem {
  id        String @id @default(cuid())
  founderId String

  // Roadmap Classification
  roadmapType String // product, gtm, personal

  // Product Roadmap Fields
  quarter String? // "Q4 2025", "Q1 2026", "Q2 2026"

  // Personal Roadmap Fields
  category String? // Mindset, Habits, Networking

  // Item Details
  title       String
  description String?
  status      String  @default("pending") // pending, in_progress, completed, cancelled

  // Dates
  dueDate     DateTime?
  completedAt DateTime?

  // System
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  founder Founder @relation(fields: [founderId], references: [id], onDelete: Cascade)

  @@map("roadmap_items")
}

// =====================================================
// COMPANY MODELS - Company Outlook System
// =====================================================

model Company {
  id        String @id @default(cuid())
  name      String
  address   String?
  website   String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  founders          CompanyFounder[]
  employees         CompanyEmployee[]
  roadmapItems      CompanyRoadmapItem[]
  tasks             Task[]              // Company tasks (companyId set, founderId null)
  crmContacts       CompanyCrmContact[]
  financialSpends   CompanyFinancialSpend[]  // Actual spending
  financialProjections CompanyFinancialProjection[]  // Projected spending
  
  @@map("companies")
}

model CompanyFounder {
  id        String @id @default(cuid())
  companyId String
  founderId String // Links to Founder.id â†’ Athlete.id (for founders who test)
  
  role      String? // "CEO", "Co-Founder"
  joinedAt  DateTime @default(now())
  
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  founder   Founder @relation(fields: [founderId], references: [id], onDelete: Cascade)
  
  @@unique([companyId, founderId])
  @@map("company_founders")
}

model CompanyEmployee {
  id          String @id @default(cuid())
  companyId   String
  
  // Employee Info (Email-Based, NO Athlete Required)
  email       String
  name        String
  role        String? // "Engineer", "Designer", "PM"
  department  String?
  phoneNumber String?
  
  joinedAt    DateTime @default(now())
  
  company     Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  // NO athleteId - separate concern!
  // If they want app, they sign up separately as Athlete
  
  @@unique([companyId, email]) // One email per company
  @@map("company_employees")
}

model CompanyRoadmapItem {
  id          String @id @default(cuid())
  companyId   String // Links to Company, not Founder
  
  // Item Classification
  itemType         String @default("Feature") // "Feature" or "Milestone"
  parentArchitecture String? // Group related features (e.g., "RunCrew", "Profile")
  roadmapType      String // "Product", "GTM", "Operations", "Infrastructure", "UX/Design"
  category         String @default("Frontend Demo") // "Frontend Demo", "API Integration", "Backend Scaffolding", "User Testing", "Release"
  
  // Core Details
  title       String
  whatItDoes  String? // User value proposition
  howItHelps  String? // How it helps overall build
  
  // Data & Integration
  fieldsData     String? // What fields/data needed
  howToGet       String? // APIs, routes, data sources
  prerequisites  String? // Setup, research, account creation, auth
  
  // Visual & Planning
  visual       String @default("List") // "List", "Timeline", "Kanban"
  orderNumber  Int? // Order in sequence (1, 2, 3...)
  
  // Time Tracking
  hoursEstimated Int? // Initial estimate
  hoursSpent     Int? // Actual time spent
  
  // Dates & Status
  targetDate    DateTime?
  dueDate       DateTime?
  status        String @default("Not Started") // Not Started, In Progress, Done
  priority      String @default("P1") // P0, P1, P2
  completedAt   DateTime?
  
  // System
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  company     Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  @@map("company_roadmap_items")
}

model CompanyCrmContact {
  id        String @id @default(cuid())
  companyId String
  
  // Contact Info
  name         String
  role         String? // "Club Director", "Partnership Lead", etc.
  email        String?
  companyName  String? // Their company (club/organization name)
  
  // Pipeline Management (BD Focus - Clubs, Partners, Integrations)
  pipeline  String @default("prospects") // prospects, warm, onboarding, active, churned
  status    String @default("new") // new, warm, active, exploring, cold
  
  // Next Steps
  nextStep  String? // "Onboarding call", "Contract review", "Integration setup"
  
  // Notes
  notes     String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  @@map("company_crm_contacts")
}

model CompanyFinancialSpend {
  id          String @id @default(cuid())
  companyId   String
  
  // INGESTED ITEM DATA - What we're ingesting per transaction
  date        DateTime  // When the spend occurred
  amount      Float     // Amount spent (negative for expenses)
  category    String    // "salaries", "marketing", "operations", "software", "office", etc.
  description String?   // Transaction description
  vendor      String?   // Who we paid
  
  // Classification
  department  String?   // Which department (if applicable)
  project     String?   // Which project (if applicable)
  
  // Receipt/Proof
  receiptUrl  String?   // Link to receipt/documentation
  
  // System
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  company     Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  @@map("company_financial_spends")
}

model CompanyFinancialProjection {
  id          String @id @default(cuid())
  companyId   String
  
  // Projection Period
  period      String    // "monthly", "quarterly", "yearly"
  periodStart DateTime  // Start of projection period
  periodEnd   DateTime  // End of projection period
  
  // TOTAL VALUES - Aggregated/Projected Amounts (NOT individual items)
  projectedRevenue    Float?  // Projected revenue for period (TOTAL)
  projectedExpenses   Float   // Projected expenses for period (TOTAL)
  projectedNet        Float?  // Projected net (revenue - expenses) (TOTAL)
  
  // Breakdown by Category (TOTAL VALUES per category)
  categoryBreakdown   Json?   // { "salaries": 50000, "marketing": 10000, "operations": 5000 }
  
  // Runway Calculation (TOTAL VALUES)
  currentCash         Float?  // Current cash on hand (TOTAL)
  monthlyBurnRate    Float?  // Monthly burn (expenses) (TOTAL)
  runwayMonths        Float?  // Months of runway (calculated: cash / monthlyBurn)
  
  // Assumptions
  assumptions         String? // Notes on assumptions for this projection
  
  // Status
  status              String @default("draft") // draft, active, archived
  
  // System
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  company     Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  @@map("company_financial_projections")
}

// =====================================================
// UNIFIED TASK MODEL - Founder OR Company
// =====================================================

model Task {
  id        String @id @default(cuid())
  
  // Polymorphic Link - ONE of these must be set
  founderId String?  // For founder personal tasks (Adam's tasks)
  companyId String?  // For company-wide tasks
  
  // Task Details
  title       String
  description String?
  status      String @default("pending") // pending, in_progress, completed, cancelled
  priority    String @default("medium") // low, medium, high, urgent
  dueDate     DateTime?
  
  // Department (for company tasks)
  department  String? // "Engineering", "Design", "Marketing"
  
  // Founder Priority Flag (for company tasks)
  isTopPriority Boolean @default(false) // Founder can mark "most important now"
  
  // Completion
  completedAt DateTime?
  
  // System
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  founder Founder? @relation(fields: [founderId], references: [id], onDelete: Cascade)
  company Company? @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  @@map("tasks")
}

// =====================================================
// MESSAGE MODEL - Group Wall Messaging
// =====================================================

model Message {
  id        String   @id @default(cuid())
  groupId   String   // RunCrew ID
  authorId  String   // Athlete ID
  author    String   // Author name (denormalized for quick display)
  content   String   // Message content
  createdAt DateTime @default(now())

  @@index([groupId, createdAt]) // Efficient queries by group and time
  @@map("messages")
}
